{#
    Formulaire location – 3 sections (Face & Client, Dates & Durée, Montant & Confirmation).
    Variables : form, edit_mode (optionnel, false), location (optionnel, pour edit), cancel_path (optionnel)
#}
{{ form_start(form, { attr: { class: edit_mode|default(false) ? 'form-modern location-form-edit' : 'form-modern' } }) }}

{% if edit_mode|default(false) %}
    {# Édition : toutes les sections visibles, regroupées #}
    <div class="location-form-section">
        <div class="form-section-header-modern">
            <div class="section-icon-modern"><i class="bi bi-pin-map"></i></div>
            <div>
                <h2 class="section-title-modern">Face & Client</h2>
                <p class="section-subtitle-modern">Face de panneau et client concerné</p>
            </div>
        </div>
        {{ form_row(form.face) }}
        {{ form_row(form.client) }}
        <div id="confirmer-mauvais-wrapper" class="mb-3"{% if not (location.face and location.face.etat == 'mauvais') %} style="display: none;"{% endif %}>
            <div class="alert alert-warning mb-2">
                <i class="bi bi-exclamation-triangle"></i> Ce panneau est en état dégradé. Souhaitez-vous quand même le louer ?
            </div>
            {{ form_row(form.confirmerEtatMauvais) }}
        </div>
    </div>
    <div class="location-form-section">
        <div class="form-section-header-modern">
            <div class="section-icon-modern"><i class="bi bi-calendar3"></i></div>
            <div>
                <h2 class="section-title-modern">Dates & Durée</h2>
                <p class="section-subtitle-modern">Période de la location</p>
            </div>
        </div>
        <div class="row g-3">
            <div class="col-md-6">{{ form_row(form.dateDebut) }}</div>
            <div class="col-md-6">{{ form_row(form.dureeMois) }}</div>
        </div>
        {{ form_row(form.dateFin) }}
    </div>
    <div class="location-form-section">
        <div class="form-section-header-modern">
            <div class="section-icon-modern"><i class="bi bi-currency-exchange"></i></div>
            <div>
                <h2 class="section-title-modern">Montant & Notes</h2>
                <p class="section-subtitle-modern">Tarif et remarques éventuelles</p>
            </div>
        </div>
        {{ form_row(form.montantMensuel) }}
        {{ form_row(form.notes) }}
    </div>
    <div class="alert alert-info location-form-info">
        <i class="bi bi-info-circle"></i> Le montant mensuel peut être modifié pour appliquer une remise ou un tarif spécial.
        <br>
        <i class="bi bi-info-circle"></i> Le système vérifiera automatiquement que la face est disponible pour la période sélectionnée.
    </div>
    <div class="form-actions-modern">
        <a href="{{ cancel_path|default(path('app_location_show', { id: location.id })) }}" class="btn-secondary-modern">
            <i class="bi bi-x-lg"></i> Annuler
        </a>
        <button type="submit" class="btn-primary-modern btn-submit-large">
            <i class="bi bi-check-lg"></i> Enregistrer
        </button>
    </div>
{% else %}
    {# Création : étapes wizard #}
    <div class="step-content" data-step="1">
        {{ form_row(form.face) }}
        <div id="disponibilite-face-block" class="mb-3" style="display: none;">
            <label class="form-label">Disponibilité de la face</label>
            <div id="disponibilite-face-content" class="small text-muted p-2 rounded bg-light"></div>
        </div>
        {{ form_row(form.client) }}
        {{ form_row(form.confirmerEtatMauvais) }}
    </div>
    <div class="step-content" data-step="2" style="display: none;">
        <div class="row g-3">
            <div class="col-md-6">{{ form_row(form.dateDebut) }}</div>
            <div class="col-md-6">{{ form_row(form.dureeMois) }}</div>
        </div>
        {{ form_row(form.dateFin) }}
    </div>
    <div class="step-content" data-step="3" style="display: none;">
        {{ form_row(form.montantMensuel) }}
        {{ form_row(form.notes) }}
    </div>
    <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mt-3">
        <div>
            <button type="button" class="btn-secondary-modern" id="stepPrevBtn" style="display: none;">
                <i class="bi bi-arrow-left"></i> Précédent
            </button>
        </div>
        <div class="d-flex gap-2">
            <button type="button" class="btn-secondary-modern" id="stepNextBtn">Suivant <i class="bi bi-arrow-right"></i></button>
            <button type="submit" class="btn-primary-modern" id="stepSubmitBtn" style="display: none;">
                <i class="bi bi-check"></i> Créer la location
            </button>
        </div>
    </div>
{% endif %}

{{ form_rest(form) }}
{{ form_end(form) }}
