{% extends 'base.html.twig' %}

{% block title %}Nouveau paiement{% endblock %}

{% block breadcrumbs %}
    <nav aria-label="breadcrumb" class="breadcrumb-nav mb-3">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="{{ path('app_dashboard') }}">Tableau de bord</a></li>
            <li class="breadcrumb-item"><a href="{{ path('app_paiement_index') }}">Paiements</a></li>
            <li class="breadcrumb-item active" aria-current="page">Nouveau paiement</li>
        </ol>
    </nav>
{% endblock %}

{% block body %}
<div class="page-header d-flex flex-wrap justify-content-between align-items-start gap-2">
    <div>
        <h1 class="page-title">Nouveau paiement</h1>
        <p class="page-description">Enregistrez un nouveau paiement pour une location</p>
    </div>
    {% if location_id %}
        <a href="{{ path('app_location_show', { id: location_id }) }}" class="btn-secondary-modern">
            <i class="bi bi-arrow-left"></i> Retour à la location
        </a>
    {% else %}
        <a href="{{ path('app_paiement_index') }}" class="btn-secondary-modern">
            <i class="bi bi-arrow-left"></i> Retour
        </a>
    {% endif %}
</div>

<div class="row g-3 g-lg-4">
    <div class="col-lg-8">
        <div class="section-card payment-form-card">
            <div class="form-card-inner">
                {% include 'paiement/_alerts.html.twig' %}
                {% set cancel_path = (location_id and location_obj) ? path('app_location_show', { id: location_obj.id }) : path('app_paiement_index') %}
                {% set submit_disabled = location_obj and (location_obj.isAnnulee or location_obj.isCompletementPaye) %}
                {% set submit_disabled_message = location_obj and location_obj.isAnnulee ? 'Location annulée' : (location_obj and location_obj.isCompletementPaye ? 'Location déjà payée' : 'Enregistrement désactivé') %}
                {% include 'paiement/_form.html.twig' with {
                    form: form,
                    cancel_path: cancel_path,
                    submit_label: 'Enregistrer le paiement',
                    cancel_label: 'Annuler',
                    location_obj: location_obj|default(null),
                    submit_disabled: submit_disabled,
                    submit_disabled_message: submit_disabled_message,
                    form_aria_label: 'Formulaire nouveau paiement'
                } %}
            </div>
        </div>
    </div>
    {% include 'paiement/_sidebar.html.twig' with { location_obj: location_obj|default(null) } %}
</div>

{% include 'paiement/_form_amount_script.html.twig' with { location_obj: location_obj|default(null) } %}
{% endblock %}
